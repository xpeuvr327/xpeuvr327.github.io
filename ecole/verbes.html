<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entra√Æneur de verbes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            position: relative;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
        }

        .ellipsis {
            position: absolute;
            top: 5%;
            right: 5%;
            font-size: 24px;
            transition: background-color 0.3s, border-radius 0.3s;
        }

        .ellipsis:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            padding: 5px;
            overflow: hidden;
        }

        h1 {
            color: #333;
        }

        #verbContainer {
            margin-bottom: 20px;
        }

        #verbQuestion {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        #verbInput {
            flex: 1;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        #submitButton {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            cursor: pointer;
            font-size: 1em;
        }

        #submitButton:hover {
            background: linear-gradient(135deg, #fad0c4 0%, #ff9a9e 100%);
        }

        #feedback {
            font-size: 1em;
            margin-top: 10px;
        }

        .correct {
            color: green;
        }

        .incorrect {
            color: red;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            cursor: pointer;
            font-size: 1em;
        }

        .conjugation-grid {
            margin-top: 20px;
            overflow-x: auto;
        }

        .conjugation-grid table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .conjugation-grid th, .conjugation-grid td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .conjugation-grid th {
            background-color: #f4f4f4;
        }

        .secondary-button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .secondary-button:hover {
            background-color: #e0e0e0;
        }

        .progress-bar {
            background-color: #f0f0f0;
            border-radius: 10px;
            padding: 3px;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            height: 20px;
            border-radius: 8px;
            transition: width 0.3s ease;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.9em;
            color: #666;
        }

        .dropdown-menu {
            position: absolute;
            top: 40px;
            right: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }

        .dropdown-menu.show {
            display: block;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background-color: #f5f5f5;
        }

        .menu-item i {
            font-size: 1.2em;
            width: 20px;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
        }

        .close-modal {
            position: absolute;
            right: 10px;
            top: 10px;
            cursor: pointer;
            font-size: 1.5em;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .settings-item {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
        }

        .settings-item:hover {
            background: #e0e0e0;
        }

        .settings-item.active {
            background: #ff9a9e;
            color: white;
        }
    </style>
</head>

<body>
    <div class="container">
        <span class="ellipsis">&nbsp;&#8942;&nbsp;</span>
        <h1>Entra√Æneur de verbes</h1>
        <div id="verbContainer">
            <p id="verbQuestion"></p>
            <div class="input-container">
                <input type="text" id="verbInput" placeholder="ex.: habe/s'habiller/hat geflogt">
            </div>
            <button id="combinedButton" class="action-button">V√©rifier</button>
            <p id="feedback"></p>
            <div id="conjugationTable" style="display: none;">
                <button id="showConjugations" class="secondary-button">Voir les conjugaisons</button>
                <div id="conjugationDetails" style="display: none;"></div>
            </div>
        </div>
        <div class="progress-container">
            <div class="progress-stats">
                <span>Correct: <span id="correctCount">0</span></span>
                <span>Progression: <span id="progressCount">0</span>/150</span>
                <span>Taux de r√©ussite: <span id="successRate">0</span>%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>
        <div class="dropdown-menu" id="menuDropdown">
            <div class="menu-item" onclick="toggleSettings()">
                <i>‚öôÔ∏è</i> Param√®tres
            </div>
            <div class="menu-item" onclick="resetProgress()">
                <i>üîÑ</i> R√©initialiser la progression
            </div>
            <div class="menu-item" onclick="toggleStats()">
                <i>üìä</i> Afficher les statistiques
            </div>
            <div class="menu-item" onclick="toggleHelp()">
                <i>‚ùî</i> Aide
            </div>
        </div>
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <span class="close-modal" onclick="toggleSettings()">√ó</span>
                <h2>Param√®tres</h2>
                <div class="settings-grid">
                    <div class="settings-item active" onclick="toggleSetting(this, 'present')">Pr√©sent</div>
                    <div class="settings-item active" onclick="toggleSetting(this, 'preterite')">Pr√©t√©rit</div>
                    <div class="settings-item active" onclick="toggleSetting(this, 'perfect')">Parfait</div>
                    <div class="settings-item active" onclick="toggleSetting(this, 'translation')">Traduction</div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let verbs = [];
        let currentVerbIndex = 0;
        let currentVerb;
        let currentFormIndex;
        let currentTense;
        let isChecking = true;
        let totalVerbsAttempted = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;

        async function fetchVerbs() {
            try {
                const response = await fetch('verbs-150.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                verbs = await response.json();
                loadProgress();
                startTraining();
            } catch (error) {
                console.error('Error loading verbs:', error);
                document.getElementById('verbQuestion').innerText = "Erreur de chargement des verbes. Veuillez actualiser la page.";
            }
        }

        const TENSE_TYPES = {
            1: 'prs',
            2: 'prk',
            3: 'prt',
            4: 'frtrad'
        };

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startTraining() {
            if (!verbs || verbs.length === 0) {
                console.error('Aucun verbe disponible');
                return;
            }
            shuffleArray(verbs);
            nextVerb();
        }

        function getRandomTense() {
            return Math.floor(Math.random() * 4) + 1;
        }

        function getPersonIndex(verb) {
            if (verb.features && verb.features.isInformal === 1) {
                return 1;
            }
            return Math.floor(Math.random() * 6);
        }

        function getReflexiveForm(verb, pronoun, baseForm) {
            if (!verb.features?.hasReflect) return baseForm;

            const reflexivePronouns = {
                'ich': 'mich',
                'du': 'dich',
                'er/sie/es': 'sich',
                'wir': 'uns',
                'ihr': 'euch',
                'Sie': 'sich'
            };

            return `${baseForm} ${reflexivePronouns[pronoun]}`;
        }

       function showConjugationTable() {
    const verb = currentVerb;
    if (!verb) return;

    const pronouns = ["ich", "du", "er/sie/es", "wir", "ihr", "Sie"];
    const auxiliary = verb.features?.aux === 'sein' ? 'sein' : 'haben';
    const auxForms = {
        'sein': ['bin', 'bist', 'ist', 'sind', 'seid', 'sind'],
        'haben': ['habe', 'hast', 'hat', 'haben', 'habt', 'haben']
    };

    let html = `
        <div class="verb-info" id="${verb.deutsch}">
            <h2>${verb.deutsch}${verb.comment ? ` (${verb.comment})` : ''}</h2>
            <p>Traduction: ${verb.frtrad}</p>
            ${verb.features?.isIrreg ? '<p>Verbe irr√©gulier</p>' : ''}
            ${verb.features?.hasReflect ? '<p>Verbe r√©fl√©chi</p>' : ''}
            ${verb.features?.hasParticle ? '<p>Verbe √† particule s√©parable</p>' : ''}
            ${verb.features?.aux === 'sein' ? '<p>Auxiliaire: sein</p>' : ''}
            ${verb.features?.isInformal === 1 ? '<p>Verbe impersonnel</p>' : ''}
        </div>
        <div class="conjugation-grid">
            <table>
                <tr>
                    <th>Pronom</th>
                    <th>Pr√©sent</th>
                    <th>Pr√©t√©rit</th>
                    <th>Pass√© compos√©</th>
                </tr>`;

    if (verb.features?.isInformal === 1) {
        const validPrsIndex = verb.prs.findIndex(form => form !== null);
        const validPrtIndex = verb.prt.findIndex(form => form !== null);

        if (validPrsIndex !== -1 && validPrtIndex !== -1) {
            const pronoun = pronouns[validPrsIndex];
            const perfectForm = `${auxForms[auxiliary][validPrsIndex]} ${verb.prk}`;

            html += `
                <tr>
                    <td>${pronoun}</td>
                    <td>${getReflexiveForm(verb, pronoun, verb.prs[validPrsIndex])}</td>
                    <td>${getReflexiveForm(verb, pronoun, verb.prt[validPrtIndex])}</td>
                    <td>${getReflexiveForm(verb, pronoun, perfectForm)}</td>
                </tr>`;
        }
    } else {
        pronouns.forEach((pronoun, i) => {
            if (verb.prs[i] === null && verb.prt[i] === null) return;

            const presentForm = verb.prs[i] ? getReflexiveForm(verb, pronoun, verb.prs[i]) : '-';
            const preteritForm = verb.prt[i] ? getReflexiveForm(verb, pronoun, verb.prt[i]) : '-';
            const perfectForm = verb.prk ?
                getReflexiveForm(verb, pronoun, `${auxForms[auxiliary][i]} ${verb.prk}`) : '-';

            html += `
                <tr>
                    <td>${pronoun}</td>
                    <td>${presentForm}</td>
                    <td>${preteritForm}</td>
                    <td>${perfectForm}</td>
                </tr>`;
        });
    }

    html += '</table></div>';
    document.getElementById('conjugationDetails').innerHTML = html;
    document.getElementById('conjugationDetails').style.display = 'block';

    const verbInfo = document.getElementById(verb.deutsch);
    if (verbInfo) {
        verbInfo.scrollIntoView({ behavior: 'smooth' });
    }
}


        function nextVerb() {
            if (currentVerbIndex >= verbs.length) {
                document.getElementById('verbQuestion').innerText = "Tous les verbes sont termin√©s !";
                document.getElementById('verbInput').style.display = 'none';
                document.getElementById('combinedButton').style.display = 'none';
                document.getElementById('feedback').innerText = '';
                document.getElementById('conjugationTable').style.display = 'none';
                return;
            }

            currentVerb = verbs[currentVerbIndex];
            const tenseNumber = getRandomTense();
            currentTense = TENSE_TYPES[tenseNumber];
            currentFormIndex = getPersonIndex(currentVerb);

            const pronouns = ["ich", "du", "er/sie/es", "wir", "ihr", "Sie"];
            const pronoun = pronouns[currentFormIndex];

            let questionText;
            if (currentTense === 'frtrad') {
                questionText = `Traduisez "${currentVerb.frtrad}" en allemand.`;
            } else {
                const tenseNames = {
                    'prs': 'au pr√©sent',
                    'prt': 'au pr√©t√©rit',
                    'prk': 'au pass√© compos√©'
                };
                questionText = `Conjuguez "${currentVerb.deutsch}" ${tenseNames[currentTense]} pour "${pronoun}"`;
                if (currentVerb.features && currentVerb.features.hasReflect === 1) {
                    questionText += " (verbe r√©fl√©chi)";
                }
            }

            document.getElementById('verbQuestion').innerText = questionText;
            document.getElementById('verbInput').value = '';
            document.getElementById('feedback').innerText = '';
            document.getElementById('conjugationTable').style.display = 'none';
            document.getElementById('conjugationDetails').style.display = 'none';
            document.getElementById('showConjugations').innerText = 'Voir les conjugaisons';

            currentVerbIndex++;
            saveProgress();
        }

        function generatePerfectForm(verb, personIndex) {
    const auxiliary = verb.features?.aux === 'sein' ? 'sein' : 'haben';
    const auxForms = {
        'sein': ['bin', 'bist', 'ist', 'sind', 'seid', 'sind'],
        'haben': ['habe', 'hast', 'hat', 'haben', 'habt', 'haben']
    };
    return `${auxForms[auxiliary][personIndex]} ${verb.prk}`;
}

function checkAnswer() {
    const userAnswer = document.getElementById('verbInput').value.trim();
    let correctAnswer;

    if (currentTense === 'frtrad') {
        correctAnswer = currentVerb.deutsch;
    } else if (currentTense === 'prk') {
        correctAnswer = generatePerfectForm(currentVerb, currentFormIndex);
        if (currentVerb.features && currentVerb.features.hasReflect === 1) {
            const reflexivePronouns = ['mich', 'dich', 'sich', 'uns', 'euch', 'sich'];
            correctAnswer = correctAnswer + ' ' + reflexivePronouns[currentFormIndex];
        }
    } else {
        correctAnswer = currentVerb[currentTense][currentFormIndex];
        if (currentVerb.features && currentVerb.features.hasReflect === 1) {
            const reflexivePronouns = ['mich', 'dich', 'sich', 'uns', 'euch', 'sich'];
            correctAnswer = correctAnswer + ' ' + reflexivePronouns[currentFormIndex];
        }
    }

    const feedbackElement = document.getElementById('feedback');
    if (normalizeString(userAnswer) === normalizeString(correctAnswer)) {
        feedbackElement.innerText = `Correct ! La r√©ponse est "${correctAnswer}".`;
        feedbackElement.className = 'correct';
        correctAnswers++;
    } else {
        feedbackElement.innerText = `Incorrect. La r√©ponse correcte est "${correctAnswer}".`;
        feedbackElement.className = 'incorrect';
        incorrectAnswers++;
    }

    updateProgress();
    document.getElementById('conjugationTable').style.display = 'block';
    saveProgress();
}

        function toggleButton() {
            const button = document.getElementById('combinedButton');
            if (isChecking) {
                checkAnswer();
                button.innerText = 'Suivant';
                isChecking = false;
            } else {
                nextVerb();
                button.innerText = 'V√©rifier';
                isChecking = true;
            }
        }

        function normalizeString(str) {
            return str
                .toLowerCase()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                .replace(/[()]/g, "")
                .trim();
        }

        function updateProgress() {
            totalVerbsAttempted = correctAnswers + incorrectAnswers;
            const progressPercentage = (totalVerbsAttempted / verbs.length) * 100;
            const successRate = totalVerbsAttempted > 0 ? (correctAnswers / totalVerbsAttempted) * 100 : 0;

            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('progressCount').textContent = totalVerbsAttempted;
            document.getElementById('successRate').textContent = successRate.toFixed(1);
            document.getElementById('progressFill').style.width = `${progressPercentage}%`;
            saveProgress();
        }

        function toggleMenu() {
            const dropdown = document.getElementById('menuDropdown');
            dropdown.classList.toggle('show');
        }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
        }

        function toggleSetting(element, setting) {
            element.classList.toggle('active');
            updateAvailableTenses();
        }

        function updateAvailableTenses() {
            const activeSettings = document.querySelectorAll('.settings-item.active');
        }

        function resetProgress() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser votre progression ?')) {
                correctAnswers = 0;
                incorrectAnswers = 0;
                totalVerbsAttempted = 0;
                currentVerbIndex = 0;
                updateProgress();
                saveProgress();
                startTraining();
            }
        }

        function saveProgress() {
            localStorage.setItem('currentVerbIndex', currentVerbIndex);
            localStorage.setItem('correctAnswers', correctAnswers);
            localStorage.setItem('incorrectAnswers', incorrectAnswers);
            localStorage.setItem('totalVerbsAttempted', totalVerbsAttempted);
        }

        function loadProgress() {
            currentVerbIndex = parseInt(localStorage.getItem('currentVerbIndex')) || 0;
            correctAnswers = parseInt(localStorage.getItem('correctAnswers')) || 0;
            incorrectAnswers = parseInt(localStorage.getItem('incorrectAnswers')) || 0;
            totalVerbsAttempted = parseInt(localStorage.getItem('totalVerbsAttempted')) || 0;
            updateProgress();
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('combinedButton').addEventListener('click', toggleButton);
            document.getElementById('showConjugations').addEventListener('click', showConjugationTable);
            document.getElementById('verbInput').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    toggleButton();
                }
            });
            document.querySelector('.ellipsis').addEventListener('click', toggleMenu);
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('menuDropdown');
                const ellipsis = document.querySelector('.ellipsis');
                if (!dropdown.contains(event.target) && !ellipsis.contains(event.target)) {
                    dropdown.classList.remove('show');
                }
            });
            startTraining();
        });

        fetchVerbs();
    </script>
</body>

</html>
